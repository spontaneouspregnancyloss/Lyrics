import React, { useState } from 'react';
import { Music, Sparkles, Download, Copy, Loader2 } from 'lucide-react';

const LyricsGenerator = () => {
  const [prompt, setPrompt] = useState('');
  const [genre, setGenre] = useState('pop');
  const [mood, setMood] = useState('upbeat');
  const [theme, setTheme] = useState('');
  const [lyrics, setLyrics] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState('');

  const genres = [
    'pop', 'rock', 'country', 'hip-hop', 'r&b', 'folk', 'indie', 
    'electronic', 'jazz', 'blues', 'reggae', 'punk', 'metal'
  ];

  const moods = [
    'upbeat', 'melancholy', 'romantic', 'energetic', 'chill', 
    'dramatic', 'nostalgic', 'rebellious', 'hopeful', 'mysterious'
  ];

  const generateLyrics = async () => {
    if (!prompt.trim()) {
      setError('Please enter a prompt or theme for your song');
      return;
    }

    setIsLoading(true);
    setError('');

    try {
      const lyricsPrompt = `Create original song lyrics based on the following specifications:
      
Genre: ${genre}
Mood: ${mood}
Theme/Prompt: ${prompt}
${theme ? `Additional theme: ${theme}` : ''}

Please create complete, original song lyrics with:
- A clear verse-chorus structure
- 2-3 verses
- A catchy chorus that repeats
- Optional bridge section
- Lyrics that fit the ${genre} genre and ${mood} mood
- Creative, original content that tells a story or expresses emotions
- Proper song structure formatting

Make sure the lyrics are completely original and don't reference or copy any existing songs. Focus on creating something fresh and creative that captures the essence of the theme while fitting the musical style requested.

Format the output with clear section labels like [Verse 1], [Chorus], [Verse 2], etc.`;

      const response = await fetch("https://api.anthropic.com/v1/messages", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          model: "claude-sonnet-4-20250514",
          max_tokens: 1500,
          messages: [
            { role: "user", content: lyricsPrompt }
          ]
        })
      });

      if (!response.ok) {
        throw new Error(`API request failed: ${response.status}`);
      }

      const data = await response.json();
      const generatedLyrics = data.content[0].text;
      setLyrics(generatedLyrics);
    } catch (err) {
      setError('Failed to generate lyrics. Please try again.');
      console.error('Error generating lyrics:', err);
    } finally {
      setIsLoading(false);
    }
  };

  const copyToClipboard = async () => {
    try {
      await navigator.clipboard.writeText(lyrics);
    } catch (err) {
      console.error('Failed to copy lyrics');
    }
  };

  const downloadLyrics = () => {
    const blob = new Blob([lyrics], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `lyrics_${genre}_${Date.now()}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900">
      <div className="container mx-auto px-4 py-8">
        {/* Header */}
        <div className="text-center mb-8">
          <div className="flex items-center justify-center gap-3 mb-4">
            <Music className="w-8 h-8 text-yellow-400" />
            <h1 className="text-4xl font-bold text-white">AI Lyrics Generator</h1>
            <Sparkles className="w-8 h-8 text-yellow-400" />
          </div>
          <p className="text-gray-300 text-lg">Create original song lyrics with AI assistance</p>
        </div>

        <div className="grid lg:grid-cols-2 gap-8">
          {/* Input Panel */}
          <div className="bg-white/10 backdrop-blur-md rounded-xl p-6 border border-white/20">
            <h2 className="text-2xl font-semibold text-white mb-6">Song Settings</h2>
            
            {/* Main Prompt */}
            <div className="mb-6">
              <label className="block text-white font-medium mb-2">
                Song Theme or Prompt *
              </label>
              <textarea
                value={prompt}
                onChange={(e) => setPrompt(e.target.value)}
                placeholder="e.g., 'A song about overcoming challenges', 'Love lost in the rain', 'Road trip with friends'..."
                className="w-full p-3 bg-white/10 border border-white/30 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                rows="3"
              />
            </div>

            {/* Genre Selection */}
            <div className="mb-6">
              <label className="block text-white font-medium mb-2">Genre</label>
              <select
                value={genre}
                onChange={(e) => setGenre(e.target.value)}
                className="w-full p-3 bg-white/10 border border-white/30 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                {genres.map(g => (
                  <option key={g} value={g} className="bg-gray-800">
                    {g.charAt(0).toUpperCase() + g.slice(1)}
                  </option>
                ))}
              </select>
            </div>

            {/* Mood Selection */}
            <div className="mb-6">
              <label className="block text-white font-medium mb-2">Mood</label>
              <select
                value={mood}
                onChange={(e) => setMood(e.target.value)}
                className="w-full p-3 bg-white/10 border border-white/30 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                {moods.map(m => (
                  <option key={m} value={m} className="bg-gray-800">
                    {m.charAt(0).toUpperCase() + m.slice(1)}
                  </option>
                ))}
              </select>
            </div>

            {/* Additional Theme */}
            <div className="mb-6">
              <label className="block text-white font-medium mb-2">
                Additional Theme (Optional)
              </label>
              <input
                type="text"
                value={theme}
                onChange={(e) => setTheme(e.target.value)}
                placeholder="e.g., 'nostalgia', 'freedom', 'heartbreak'..."
                className="w-full p-3 bg-white/10 border border-white/30 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            {/* Generate Button */}
            <button
              onClick={generateLyrics}
              disabled={isLoading}
              className="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 disabled:from-gray-500 disabled:to-gray-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 flex items-center justify-center gap-2"
            >
              {isLoading ? (
                <>
                  <Loader2 className="w-5 h-5 animate-spin" />
                  Generating Lyrics...
                </>
              ) : (
                <>
                  <Sparkles className="w-5 h-5" />
                  Generate Lyrics
                </>
              )}
            </button>

            {error && (
              <div className="mt-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-300">
                {error}
              </div>
            )}
          </div>

          {/* Output Panel */}
          <div className="bg-white/10 backdrop-blur-md rounded-xl p-6 border border-white/20">
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-2xl font-semibold text-white">Generated Lyrics</h2>
              {lyrics && (
                <div className="flex gap-2">
                  <button
                    onClick={copyToClipboard}
                    className="p-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors"
                    title="Copy to clipboard"
                  >
                    <Copy className="w-4 h-4" />
                  </button>
                  <button
                    onClick={downloadLyrics}
                    className="p-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors"
                    title="Download as text file"
                  >
                    <Download className="w-4 h-4" />
                  </button>
                </div>
              )}
            </div>

            <div className="min-h-96">
              {lyrics ? (
                <div className="bg-black/20 rounded-lg p-4 border border-white/10">
                  <pre className="text-white whitespace-pre-wrap font-mono text-sm leading-relaxed">
                    {lyrics}
                  </pre>
                </div>
              ) : (
                <div className="flex items-center justify-center h-96 text-gray-400">
                  <div className="text-center">
                    <Music className="w-16 h-16 mx-auto mb-4 opacity-50" />
                    <p>Your generated lyrics will appear here</p>
                    <p className="text-sm mt-2">Enter a prompt and click "Generate Lyrics" to get started</p>
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>

        {/* Features */}
        <div className="mt-12 grid md:grid-cols-3 gap-6 text-center">
          <div className="bg-white/5 p-6 rounded-xl">
            <Sparkles className="w-8 h-8 text-yellow-400 mx-auto mb-3" />
            <h3 className="text-white font-semibold mb-2">AI-Powered</h3>
            <p className="text-gray-300 text-sm">Advanced AI creates original, creative lyrics tailored to your specifications</p>
          </div>
          <div className="bg-white/5 p-6 rounded-xl">
            <Music className="w-8 h-8 text-blue-400 mx-auto mb-3" />
            <h3 className="text-white font-semibold mb-2">Multiple Genres</h3>
            <p className="text-gray-300 text-sm">Support for 13+ music genres from pop and rock to jazz and electronic</p>
          </div>
          <div className="bg-white/5 p-6 rounded-xl">
            <Download className="w-8 h-8 text-green-400 mx-auto mb-3" />
            <h3 className="text-white font-semibold mb-2">Export Ready</h3>
            <p className="text-gray-300 text-sm">Copy to clipboard or download your lyrics as a text file</p>
          </div>
        </div>
      </div>
    </div>
  );
};

export default LyricsGenerator;
